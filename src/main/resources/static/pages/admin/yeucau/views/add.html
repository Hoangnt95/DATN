<style>
    #buttons-container {
        display: flex;
    }

    .container {
        margin: 10px;
    }

    .insideDiv {
        padding: 10px;
        cursor: pointer;
        width: 40px;
        height: 40px;
        margin: 4px;
        border: 1px solid rgb(180, 180, 180);
    }

    .button_checked {
        transition: 0.3s all;
        border: 1px solid rgb(0, 0, 0) !important;
    }

    #image-container img {
        margin-bottom: 10px;
    }

    .info {
        max-height: 208px;
        overflow: hidden;
    }

    .text-limit {
        max-height: 60px;
        overflow: hidden;
    }

    .toggle-button {
        background: transparent;
        border: none;
        color: blue;
    }

    .card-body {
        padding: 0px;
    }

    .card-header {
        padding: 0px;
    }

    .card-content {
        display: flex;
        margin: 0;
    }

    .left {
        display: flex;
        flex-direction: column;
        width: 1100px;
    }

    #formSanPhamDaMua, #formSanPhamThayThe, #formYeuCau {
        border: 1px solid black; /* Chỉ để trực quan hóa các div */
        padding: 10px;
        margin: 5px;
    }

    #formSanPhamDaMua, #formSanPhamThayThe {
        height: 350px;
    }

    #formYeuCau {
        height: 710px;
    }

    .right {
        /* Điều chỉnh kích thước của DIV 3 nếu cần */
        width: 400px;
        Height: 710px;
    }

</style>
<div ng-show="isLoading" class="loading-spinner">
    <div class="text-center" style="  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.5); /* Màu nền đục để làm mờ */
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 999; ">
        <div class="spinner-border" role="status">
            <span class="sr-only">Loading...</span>
        </div>
    </div>
</div>
<div class="container">
    <form name="addYeuCauForm">
        <div class="card-header bg-white">
            <h5 class="card-title p-2 mt-2">
                Yêu Cầu
            </h5>
        </div>

        <div class="card-content">
            <div class="left">

                <div id="formSanPhamDaMua">
                    <div class="box-shadow-page">
                        <div class="card-header bg-white">
                            <h5 class="card-title p-2 mt-2">
                                Sản Phẩm Đã Mua
                            </h5>
                        </div>
                        <div class="card-body">
                            <div>
                                <table class="table align-middle text-center">
                                    <thead>
                                    <tr>
                                        <th>Mã SP</th>
                                        <th>Tên</th>
                                        <th>Số Lượng Trả</th>
                                        <th>Kích Cỡ</th>
                                        <th>Màu Sắc</th>
                                        <th>Đơn Giá</th>
                                        <th>Thao Tác</th>
                                    </tr>
                                    </thead>
                                    <tbody style="max-height: 350px;overflow: auto">
                                    <tr ng-repeat="(index,hoaDonChiTiet) in hoaDon.listHoaDonChiTiet">
                                        <td>SP{{hoaDonChiTiet.bienTheGiay.id}},{{hoaDonChiTiet.id}}</td>
                                        <td>{{hoaDonChiTiet.bienTheGiay.giayResponse.ten}}</td>
                                        <td>
                                            <input type="number" ng-model="hoaDonChiTiet.soLuongTra" min="0"
                                                   ng-init="hoaDonChiTiet.soLuongTra = 0"
                                                   max="{{hoaDonChiTiet.soLuongDuocTra}}"
                                                   ng-change="updateTongTienTra()">
                                            <span>/ {{hoaDonChiTiet.soLuongTraMax}}</span>
                                        </td>
                                        <td>{{hoaDonChiTiet.bienTheGiay.kichThuoc.ten}}</td>
                                        <td>{{hoaDonChiTiet.bienTheGiay.mauSac.ten}}</td>
                                        <td>{{ hoaDonChiTiet.donGia | formatToVND }}</td>
                                        <td>
                                            <button type="button" class="btn btn-primary"
                                                    ng-click="addToMapSanPhamTra(index+1,hoaDonChiTiet)">Trả Hàng
                                            </button>
                                        </td>
                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>


                <div id="formSanPhamThayThe">
                    <div class="box-shadow-page">
                        <div class="card-header bg-white">
                            <h5 class="card-title p-2 mt-2">
                                Sản Phẩm Trả
                            </h5>
                        </div>
                        <div class="card-body">
                            <table class="table align-middle text-center" border="1">
                                <thead>
                                <tr>
                                    <th>Mã</th>
                                    <th>Loại</th>
                                    <th>Tên Sản Phẩm</th>
                                    <th>Số Lượng Trả/Đổi</th>
                                    <th>Kích Cỡ</th>
                                    <th>Màu Sắc</th>
                                    <th>Đơn Giá</th>
                                    <th>Thao Tác</th>
                                </tr>
                                </thead>
                                <tbody ng-repeat="item in arrayForRepeat track by $index"
                                       style="max-height: 250px;overflow: auto">
                                <tr>
                                    <td>{{ item.key}}</td>
                                    <td>Giày Trả</td>
                                    <td>{{ item.value.hoaDonChiTiet.bienTheGiay.giayResponse.ten }}</td>
                                    <td>x{{ item.value.hoaDonChiTiet.soLuongTra }}</td>
                                    <td>{{ item.value.hoaDonChiTiet.bienTheGiay.kichThuoc.ten }}</td>
                                    <td>{{ item.value.hoaDonChiTiet.bienTheGiay.mauSac.ten }}</td>
                                    <td>{{ formatToVND(item.value.hoaDonChiTiet.donGia) }}</td>
                                    <td>
                                        <button class="btn btn-warning" ng-click="ghiChu_LyDo(item)">Lý Do</button>
                                        <button class="btn btn-danger" ng-click="deleteGiayTra(item)">Xóa</button>
                                    </td>
                                </tr>

                                <tr ng-repeat="item1 in arrayForRepeat1 track by $index"
                                    ng-if="item1.key === item.key">
                                    <td>{{ item1.key }}</td>
                                    <td>Giày Đổi</td>
                                    <td>{{ item1.value.bienTheGiay.ten }}</td>
                                    <td>x{{ item1.value.soLuongDoi }}</td>
                                    <td>{{ item1.value.bienTheGiay.kichThuoc.ten }}</td>
                                    <td>{{ item1.value.bienTheGiay.mauSac.ten }}</td>
                                    <td>{{ item1.value.bienTheGiay.giaBan }}</td>
                                    <td>
                                        <button class="btn btn-warning" ng-click="chonLaiGiay(item)">Chọn Lại</button>
                                        <button type="button" class="btn btn-danger" ng-click="deleteGiayDoi(item1)">
                                            Xóa
                                        </button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>


                <!-- Modal Điền: Lý Do + Ghi Chú-->
                <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
                     aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Lý Do Đổi Trả</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close" ng-click="resetLyDo_ghiChu()"></button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <select class="form-select" id="floatingSelect"
                                                    placeholder="Chọn Lý Do Đổi/Trả"
                                                    aria-label="Floating label select example" ng-model="lyDo">
                                                <option ng-repeat="lyDo in listLyDo" value="{{lyDo.id}}">{{lyDo.ten}}
                                                </option>
                                            </select>
                                            <label for="floatingSelect">Lý Do</label>
                                        </div>
                                    </div>
                                    <div class="mb-3">
                                        <div class="form-floating">
                                            <textarea class="form-control"
                                                      placeholder="Hãy mô tả chi tiết lý do đổi/trả"
                                                      id="floatingTextarea2" style="height: 100px"
                                                      ng-model="ghiChu">
                                            </textarea>
                                            <label for="floatingTextarea2">Mô Tả Chi Tiết</label>
                                        </div>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                                        ng-click="resetLyDo_ghiChu()">Quay Về
                                </button>
                                <button type="button" class="btn btn-success" data-bs-dismiss="modal"
                                        ng-click="updateLyDoVaGhiChu(giayTra.key,lyDo,ghiChu)">Lưu
                                </button>
                                <button type="button" class="btn btn-primary"
                                        ng-click="checkFormMoTaLyDo(lyDo,ghiChu)">Đổi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="modal fade" id="exampleModalToggle" aria-hidden="true"
                     aria-labelledby="exampleModalToggleLabel"
                     tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalToggleLabel">Giày</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="box-shadow-page">
                                    <div class="card-body">

                                        <div class="d-flex add-search-custom">
                                            <div class="input-group w-60">
                                            <span class="input-group-text" id="basic-addon1"><i
                                                    class="fas fa-search"></i></span>
                                                <input id="seachText" class="form-control" type="text"
                                                       ng-model="searchText"
                                                       placeholder="Nhập Mã Yêu Cầu">
                                                <button class="btn btn-custom " ng-click="searchGiay()">Tìm kiếm
                                                </button>
                                                </button>
                                            </div>
                                        </div>

<!--                                        <div>-->
<!--                                            <table class="table align-middle text-center" border="1">-->
<!--                                                <thead>-->
<!--                                                <tr>-->
<!--                                                    <th>Mã Sản Phẩm</th>-->
<!--                                                    <th>Tên</th>-->
<!--                                                    <th>Thao Tác</th>-->
<!--                                                </tr>-->
<!--                                                </thead>-->
<!--                                                <tbody style="max-height: 350px;overflow: auto">-->
<!--                                                <tr ng-repeat="(index,giay) in listGiay">-->
<!--                                                    <td>SP{{giay.id}}</td>-->
<!--                                                    <td>{{giay.ten}}</td>-->
<!--                                                    <td>-->
<!--                                                        <button class="btn btn-primary"-->
<!--                                                                data-bs-target="#exampleModalToggle2"-->
<!--                                                                data-bs-toggle="modal"-->
<!--                                                                data-bs-dismiss="modal" ng-click="chonGiayDoi(giay)">-->
<!--                                                            Chọn-->
<!--                                                        </button>-->
<!--                                                    </td>-->
<!--                                                </tr>-->
<!--                                                </tbody>-->
<!--                                            </table>-->
<!--                                        </div>-->

                                        <div class="item row">
                                            <div class="col-md-2 mb-2" ng-repeat="giay in listGiay">
                                                <button data-bs-toggle="modal" data-bs-target="#showGiaySelect" id="buttonModalSanPham"
                                                        hidden=""></button>
                                                <div class="p-2 hover-item" ng-click="addOrder(giay.id)" data-bs-toggle="tooltip"
                                                     data-bs-placement="right" title="{{giay.ten}}">
                                                    <div class="position-relative" style="text-align: center;">
                                                        <img width="60%" class="rounded-3"
                                                             style="height: 85px; width: 85px; object-fit: contain"
                                                             ng-src="{{giay.lstAnh && giay.lstAnh.length > 0 ? giay.lstAnh[0] : 'https://product.hstatic.net/1000361048/product/giay_co_lung_forum_trang_fy4976_02_standard_hover_1af12c21fb0a498eb38c9d41c04e4514_grande.jpg'}}"
                                                             alt="Ảnh giày">
                                                    </div>
                                                    <p class="mt-1"
                                                       style="text-wrap: nowrap;overflow: hidden;text-align: center;text-overflow: ellipsis;">
                                                        {{giay.ten}}</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div ng-show="numOfPages > 1" data-pagination="" data-num-pages="numOfPages"
                                                 data-current-page="curPage"
                                                 data-max-size="maxSize"
                                                 data-boundary-links="true">
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn-danger" data-bs-dismiss="modal" aria-label="Close">Quay
                                    Về
                                </button>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="modal fade" id="exampleModalToggle2" aria-hidden="true"
                     aria-labelledby="exampleModalToggleLabel2" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalToggleLabel2">Biến Thể Gìay</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                            </div>
                            <div class="modal-body">


                                <div class="row">
                                    <div id="" class=" col-md-4">
                                        <div id="carouselExampleControls" class="carousel slide"
                                             data-bs-ride="carousel">
                                            <div class="carousel-inner" id="image-container">
                                            </div>
                                            <button class="carousel-control-prev" type="button"
                                                    data-bs-target="#carouselExampleControls"
                                                    data-bs-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Previous</span>
                                            </button>
                                            <button class="carousel-control-next" type="button"
                                                    data-bs-target="#carouselExampleControls"
                                                    data-bs-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="visually-hidden">Next</span>
                                            </button>
                                        </div>

                                    </div>
                                    <div class="col-md-6">
                                        <div class="side-left">
                                            <div class="title">
                                                <h5>{{giayDetail.ten}} </h5>
                                                <h5>Giá: <span id="price-product">{{giayDetail.giaBan}}</span></h5>
                                                <h5>Số lượng : <span id="quantity">{{giayDetail.soLuong}}</span></h5>
                                            </div>
                                            <div id="buttons-container"></div>
                                            <div id="product-info"></div>
                                            <div class="size-selector">
                                                <h2>Kích thước:</h2>
                                                <div id="sizeButtons"></div>
                                            </div>

                                        </div>
                                    </div>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-primary" data-bs-target="#exampleModalToggle"
                                        data-bs-toggle="modal"
                                        data-bs-dismiss="modal">Quay Về
                                </button>
                                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" aria-label="Close"
                                        ng-click="giaySelected()">Chọn
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="right">
                <div id="formYeuCau">

                    <div class="form-group">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="floatingInput" ng-model="hoaDon.khachHang.ten"
                                   readonly>
                            <label for="floatingInput">Khách Hàng</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="form-floating">
                            <select class="form-select" id="floatingSelect1"
                                    placeholder="Chọn Lý Do Đổi/Trả"
                                    aria-label="Floating label select example" name="nguoiThucHien"
                                    ng-model="yeuCau.nguoiThucHien">
                                <option ng-repeat="nhanVien in listNhanVien" value="{{nhanVien.id}}">
                                    {{nhanVien.hoTen}}
                                </option>
                            </select>
                            <label for="floatingSelect1">Nhân Viên</label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Trả hàng/: <a style="color: #0c63e4">HD{{hoaDon.id}} -
                            {{hoaDon.nhanVien.ten}}</a></label>
                    </div>

                    <div class="form-group">
                        <label>Tổng tiền mua hàng: {{tongTienHangMua | formatToVND}}</label>
                    </div>

                    <div class="form-group">
                        <label>Tổng tiền hàng trả: {{ tongTienHangTra | formatToVND }}</label>
                    </div>

                    <div class="form-group">
                        <label>Tổng tiền hàng đổi: {{ tongTienHangDoi | formatToVND }}</label>
                    </div>

                    <div class="form-group">
                        <label>Tổng tiền trả khách: {{ tongTienTraKhach | formatToVND }}</label>
                    </div>

                    <div class="form-group">
                        <label>Tổng tiền trả khách: {{ tongTienKhachPhaiTra | formatToVND }}</label>
                    </div>

                    <div class="form-group">
                        <div class="form-floating">
                            <textarea class="form-control"
                                      name="ghiChu" ng-model="yeuCau.ghiChu"
                                      id="floatingTextarea3" style="height: 100px">
                            </textarea>
                            <label for="floatingTextarea3">Ghi Chú</label>
                        </div>
                    </div>
                    <button type="button" class="btn btn-primary" ng-click="kiemTraSanPhamTra()">Tạo Mới</button>
                </div>
            </div>
        </div>

    </form>
</div>
